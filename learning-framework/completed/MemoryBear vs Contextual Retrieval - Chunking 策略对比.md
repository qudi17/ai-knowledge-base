---
tags: [rag, chunking, memorybear, contextual-retrieval, comparison]
created: 2026-02-28
type: technical-comparison
status: draft
---

# MemoryBear vs Contextual Retrieval - Chunking ç­–ç•¥å¯¹æ¯”

**ç ”ç©¶æ—¥æœŸ**ï¼š2026-02-28  
**å¯¹æ¯”å¯¹è±¡**ï¼š
- MemoryBearï¼ˆä¼ä¸šçº§è®°å¿†å¹³å°ï¼‰
- Contextual Retrievalï¼ˆAnthropic RAG ä¼˜åŒ–æ–¹æ¡ˆï¼‰

**åº”ç”¨åœºæ™¯**ï¼š100 ä¸‡ç ”æŠ¥ RAG ç³»ç»Ÿçš„ chunking ç­–ç•¥é€‰æ‹©

---

## ğŸ“Š æ‰§è¡Œæ‘˜è¦

### æ ¸å¿ƒå·®å¼‚

| ç»´åº¦ | MemoryBear | Contextual Retrieval |
|------|-----------|---------------------|
| **Chunking å•å…ƒ** | å¯¹è¯æ¶ˆæ¯ï¼ˆ1 Message = 1 Chunkï¼‰ | æ–‡æ¡£åˆ†å—ï¼ˆ800 tokens/chunkï¼‰ |
| **ä¸Šä¸‹æ–‡ä¿ç•™** | è§’è‰²ä¿¡æ¯ï¼ˆspeakerï¼‰ | æ–‡æ¡£çº§ä¸Šä¸‹æ–‡ï¼ˆå…¬å¸/æ—¶é—´/ç±»å‹ï¼‰ |
| **åˆ†å—ç­–ç•¥** | 7 ç§å¯é€‰ï¼ˆToken/Semantic/LLM ç­‰ï¼‰ | å›ºå®š + ä¸Šä¸‹æ–‡å¢å¼º |
| **æ ¸å¿ƒåˆ›æ–°** | å¤šç­–ç•¥å¯é…ç½® | ä¸º chunk æ·»åŠ ä¸Šä¸‹æ–‡ |
| **é€‚ç”¨åœºæ™¯** | å¯¹è¯è®°å¿† | æ–‡æ¡£æ£€ç´¢ |

---

## ğŸ§  MemoryBear çš„ Chunking æœºåˆ¶

### æ ¸å¿ƒè®¾è®¡å“²å­¦

**1 Message = 1 Chunk**

æ¯ä¸ªå¯¹è¯æ¶ˆæ¯åˆ›å»ºä¸€ä¸ª chunkï¼Œç›´æ¥ç»§æ‰¿è§’è‰²ä¿¡æ¯ï¼ˆspeakerï¼‰ã€‚

**ä»£ç ä½ç½®**ï¼š
[`api/app/core/memory/llm_tools/chunker_client.py#L198-L267`](https://github.com/qudi17/MemoryBear/blob/main/api/app/core/memory/llm_tools/chunker_client.py#L198-L267)

**æ ¸å¿ƒä»£ç **ï¼š
```python
# æŒ‰æ¶ˆæ¯åˆ†å—ï¼šæ¯ä¸ªæ¶ˆæ¯åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ª chunkï¼Œç›´æ¥ç»§æ‰¿è§’è‰²
for msg_idx, msg in enumerate(dialogue.context.msgs):
    msg_content = msg.msg.strip()
    
    if not msg_content:
        continue
    
    # å¦‚æœæ¶ˆæ¯å¤ªé•¿ï¼Œå¯ä»¥è¿›ä¸€æ­¥åˆ†å—
    if len(msg_content) > self.chunk_size:
        sub_chunks = self.chunker(msg_content)
        for idx, sub_chunk in enumerate(sub_chunks):
            chunk = Chunk(
                content=f"{msg.role}: {sub_chunk_text}",
                speaker=msg.role,  # ç›´æ¥ç»§æ‰¿è§’è‰²
                metadata={
                    "message_index": msg_idx,
                    "message_role": msg.role,
                    "sub_chunk_index": idx,
                }
            )
    else:
        chunk = Chunk(
            content=f"{msg.role}: {msg_content}",
            speaker=msg.role,  # ç›´æ¥ç»§æ‰¿è§’è‰²
            metadata={
                "message_index": msg_idx,
                "message_role": msg.role,
            }
        )
```

---

### 7 ç§åˆ†å—ç­–ç•¥

**é…ç½®æ¨¡å‹**ï¼š[`ChunkerConfig`](https://github.com/qudi17/MemoryBear/blob/main/api/app/core/memory/models/config_models.py)

```python
class ChunkerConfig(BaseModel):
    chunker_strategy: str  # åˆ†å—ç­–ç•¥åç§°
    embedding_model: str   # åµŒå…¥æ¨¡å‹
    chunk_size: int = 2048  # é»˜è®¤ 2048 å­—ç¬¦
    threshold: float = 0.8  # è¯­ä¹‰ç›¸ä¼¼åº¦é˜ˆå€¼
```

**æ”¯æŒçš„ç­–ç•¥**ï¼š

| ç­–ç•¥ | å®ç° | é€‚ç”¨åœºæ™¯ | é…ç½®å‚æ•° |
|------|------|---------|---------|
| **TokenChunker** | chonkie.TokenChunker | ç®€å•å¿«é€Ÿ | chunk_size, chunk_overlap |
| **SemanticChunker** | chonkie.SemanticChunker | è¯­ä¹‰è¿è´¯ | embedding_model, threshold |
| **RecursiveChunker** | chonkie.RecursiveChunker | ç»“æ„åŒ–æ–‡æœ¬ | rules, min_characters |
| **LateChunker** | chonkie.LateChunker | é•¿æ–‡æ¡£ | embedding_model, rules |
| **NeuralChunker** | chonkie.NeuralChunker | é«˜è´¨é‡ | model |
| **LLMChunker** | è‡ªå®šä¹‰ LLM åˆ†å— | æ™ºèƒ½åˆ†å— | llm_client |
| **HybridChunker** | è‡ªå®šä¹‰æ··åˆç­–ç•¥ | å¹³è¡¡æ•ˆæœ | semantic_threshold |
| **SentenceChunker** | chonkie.SentenceChunker | å¥å­çº§ | delim, min_sentences |

---

### Chunking æµç¨‹

```
å¯¹è¯æ•°æ® (DialogData)
    â†“
ChunkerClient.generate_chunks()
    â†“
éå†æ¯ä¸ªæ¶ˆæ¯ (msg)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¶ˆæ¯é•¿åº¦ > chunk_size?       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”
    â”‚ æ˜¯    â”‚  å¦
    â†“       â†“
è¿›ä¸€æ­¥åˆ†å—  ç›´æ¥ä½œä¸º chunk
    â†“       â†“
ä½¿ç”¨é…ç½®çš„  åˆ›å»º chunk
åˆ†å—ç­–ç•¥    content = f"{role}: {content}"
    â†“       â†“
åˆ›å»º sub-chunks  æ·»åŠ åˆ° dialogue.chunks
    â†“
ç»§æ‰¿ speaker ä¿¡æ¯
    â†“
è¿”å› chunks åˆ—è¡¨
```

---

### Chunk æ•°æ®ç»“æ„

```python
class Chunk:
    content: str       # å†…å®¹ï¼ˆåŒ…å«è§’è‰²å‰ç¼€ï¼‰
    speaker: str       # è¯´è¯è€…ï¼ˆuser/assistantï¼‰
    metadata: dict     # å…ƒæ•°æ®
    
# ç¤ºä¾‹
Chunk(
    content="user: æˆ‘æƒ³æŸ¥è¯¢è´µå·èŒ…å° 2023 å¹´çš„è¥æ”¶æ•°æ®",
    speaker="user",
    metadata={
        "message_index": 0,
        "message_role": "user",
        "chunker_strategy": "RecursiveChunker",
    }
)
```

---

### ä¸Šä¸‹æ–‡ä¿ç•™æœºåˆ¶

**MemoryBear çš„ä¸Šä¸‹æ–‡ä¿ç•™æ–¹å¼**ï¼š

1. **è§’è‰²ä¿¡æ¯**ï¼š
   - æ¯ä¸ª chunk ç»§æ‰¿ speakerï¼ˆuser/assistantï¼‰
   - å†…å®¹æ ¼å¼ï¼š`f"{role}: {content}"`

2. **ä½ç½®ä¿¡æ¯**ï¼š
   - message_indexï¼šæ¶ˆæ¯åœ¨å¯¹è¯ä¸­çš„ç´¢å¼•
   - sub_chunk_indexï¼šå­ chunk ç´¢å¼•ï¼ˆå¦‚æœæœ‰ï¼‰

3. **å…ƒæ•°æ®**ï¼š
   - chunker_strategyï¼šä½¿ç”¨çš„åˆ†å—ç­–ç•¥
   - å…¶ä»–è‡ªå®šä¹‰å…ƒæ•°æ®

**å±€é™æ€§**ï¼š
- âŒ æ²¡æœ‰æ–‡æ¡£çº§ä¸Šä¸‹æ–‡ï¼ˆå¦‚å…¬å¸åã€æ—¶é—´ã€æŠ¥å‘Šç±»å‹ï¼‰
- âŒ è·¨ chunk çš„ä¸Šä¸‹æ–‡ä¾èµ–å¯èƒ½ä¸¢å¤±
- âŒ æ£€ç´¢æ—¶æ— æ³•åˆ©ç”¨æ–‡æ¡£çº§å…ƒæ•°æ®

---

## ğŸ“„ Contextual Retrieval çš„ Chunking æœºåˆ¶

### æ ¸å¿ƒè®¾è®¡å“²å­¦

**ä¸ºæ¯ä¸ª chunk æ·»åŠ æ–‡æ¡£çº§ä¸Šä¸‹æ–‡**

**è½¬æ¢ç¤ºä¾‹**ï¼š
```
åŸå§‹ Chunk:
"è¥æ”¶åŒæ¯”å¢é•¿ 25%ï¼Œè¾¾åˆ° 50 äº¿å…ƒ"

Contextualized Chunk:
"[ä¸Šä¸‹æ–‡] è´µå·èŒ…å° (600519.SH) 2024 å¹´æ·±åº¦ç ”ç©¶æŠ¥å‘Šï¼Œ
è´¢åŠ¡åˆ†æç« èŠ‚ï¼Œ2023 å¹´å¹´æŠ¥æ•°æ®ã€‚
[æ­£æ–‡] è¥æ”¶åŒæ¯”å¢é•¿ 25%ï¼Œè¾¾åˆ° 50 äº¿å…ƒ"
```

---

### ä¸Šä¸‹æ–‡ç”Ÿæˆ Prompt

**Anthropic å®˜æ–¹ Prompt**ï¼š
```
<document>
{{WHOLE_DOCUMENT}}
</document>
Here is the chunk we want to situate within the whole document
<chunk>
{{CHUNK_CONTENT}}
</chunk>
Please give a short succinct context to situate this chunk within the 
overall document for the purposes of improving search retrieval of the 
chunk. Answer only with the succinct context and nothing else.
```

**é’ˆå¯¹ç ”æŠ¥ä¼˜åŒ–çš„ Prompt**ï¼š
```
<document>
{{å®Œæ•´æŠ¥å‘Šå†…å®¹}}
</document>

<chunk>
{{chunk å†…å®¹}}
</chunk>

<metadata>
å…¬å¸åï¼š{{å…¬å¸å}}
è‚¡ç¥¨ä»£ç ï¼š{{ä»£ç }}
æŠ¥å‘Šæ—¥æœŸï¼š{{æ—¥æœŸ}}
ç« èŠ‚ï¼š{{ç« èŠ‚å}}
</metadata>

è¯·ä¸ºè¿™ä¸ª chunk ç”Ÿæˆç®€çŸ­çš„ä¸Šä¸‹æ–‡è¯´æ˜ï¼ˆ50-100 å­—ï¼‰ï¼ŒåŒ…å«ï¼š
1. å…¬å¸åç§°å’Œè‚¡ç¥¨ä»£ç 
2. æŠ¥å‘Šç±»å‹å’Œæ—¥æœŸ
3. æ‰€å±ç« èŠ‚
4. å…³é”®è´¢åŠ¡æŒ‡æ ‡ï¼ˆå¦‚æœ chunk æ¶‰åŠï¼‰

åªè¾“å‡ºä¸Šä¸‹æ–‡ï¼Œä¸è¦å…¶ä»–å†…å®¹ã€‚
```

---

### Chunking æµç¨‹

```
æ–‡æ¡£é›†åˆ
    â†“
æ–‡æ¡£åˆ†å—ï¼ˆ800 tokens/chunkï¼‰
    â†“
ä¸ºæ¯ä¸ª chunk ç”Ÿæˆä¸Šä¸‹æ–‡ï¼ˆClaudeï¼‰
    â†“
Prepend ä¸Šä¸‹æ–‡åˆ° chunk
    â†“
åˆ›å»º Embedding å’Œ BM25 ç´¢å¼•
    â†“
æ£€ç´¢æ—¶ä½¿ç”¨ contextualized chunk
```

---

### Chunk æ•°æ®ç»“æ„

```python
{
    "chunk_id": "chunk_001",
    "company_name": "è´µå·èŒ…å°",
    "stock_code": "600519.SH",
    "report_date": "2024-03-15",
    "section": "è´¢åŠ¡åˆ†æ",
    "chunk_content": "è¥æ”¶åŒæ¯”å¢é•¿ 25%ï¼Œè¾¾åˆ° 50 äº¿å…ƒ",
    "contextualized_content": "[ä¸Šä¸‹æ–‡] è´µå·èŒ…å° (600519.SH) 2024 å¹´æ·±åº¦ç ”ç©¶æŠ¥å‘Šï¼Œè´¢åŠ¡åˆ†æç« èŠ‚ï¼Œ2023 å¹´å¹´æŠ¥æ•°æ®ã€‚[æ­£æ–‡] è¥æ”¶åŒæ¯”å¢é•¿ 25%ï¼Œè¾¾åˆ° 50 äº¿å…ƒ",
    "industry": "é£Ÿå“é¥®æ–™",
}
```

---

### ä¸Šä¸‹æ–‡ä¿ç•™æœºåˆ¶

**Contextual Retrieval çš„ä¸Šä¸‹æ–‡ä¿ç•™æ–¹å¼**ï¼š

1. **æ–‡æ¡£çº§å…ƒæ•°æ®**ï¼š
   - å…¬å¸åã€è‚¡ç¥¨ä»£ç 
   - æŠ¥å‘Šæ—¥æœŸã€ç±»å‹
   - ç« èŠ‚åã€è¡Œä¸šåˆ†ç±»

2. **ä¸Šä¸‹æ–‡å‰ç¼€**ï¼š
   - æ¯ä¸ª chunk  prepend 50-100 tokens çš„ä¸Šä¸‹æ–‡
   - ä¸Šä¸‹æ–‡åŒ…å«æ–‡æ¡£çº§ä¿¡æ¯

3. **å­—æ®µçº§ç´¢å¼•**ï¼š
   - contextualized_contentï¼ˆæƒé‡ 5ï¼‰
   - chunk_contentï¼ˆæƒé‡ 2ï¼‰
   - company_nameï¼ˆæƒé‡ 10ï¼‰
   - stock_codeï¼ˆè¿‡æ»¤ï¼‰

**ä¼˜åŠ¿**ï¼š
- âœ… ä¿ç•™å®Œæ•´æ–‡æ¡£çº§ä¸Šä¸‹æ–‡
- âœ… æ£€ç´¢æ—¶å¯åˆ©ç”¨ä¸Šä¸‹æ–‡ä¿¡æ¯
- âœ… æ”¯æŒå­—æ®µåŠ æƒ BM25

---

## ğŸ†š å…³é”®å·®å¼‚å¯¹æ¯”

### 1. Chunking å•å…ƒ

| ç»´åº¦ | MemoryBear | Contextual Retrieval |
|------|-----------|---------------------|
| **åŸºæœ¬å•å…ƒ** | å¯¹è¯æ¶ˆæ¯ | æ–‡æ¡£åˆ†å— |
| **å¤§å°** | å¯å˜ï¼ˆå–å†³äºæ¶ˆæ¯é•¿åº¦ï¼‰ | å›ºå®šï¼ˆ~800 tokensï¼‰ |
| **è¾¹ç•Œ** | è‡ªç„¶å¯¹è¯è¾¹ç•Œ | å›ºå®šé•¿åº¦/æ®µè½è¾¹ç•Œ |
| **é€‚ç”¨** | å¯¹è¯åœºæ™¯ | æ–‡æ¡£åœºæ™¯ |

---

### 2. ä¸Šä¸‹æ–‡ç±»å‹

| ç»´åº¦ | MemoryBear | Contextual Retrieval |
|------|-----------|---------------------|
| **ä¸Šä¸‹æ–‡ç±»å‹** | å¯¹è¯ä¸Šä¸‹æ–‡ï¼ˆè§’è‰²ï¼‰ | æ–‡æ¡£ä¸Šä¸‹æ–‡ï¼ˆå…¬å¸/æ—¶é—´ï¼‰ |
| **ä¿ç•™æ–¹å¼** | å‰ç¼€ï¼ˆrole:ï¼‰ | å‰ç¼€ï¼ˆ[ä¸Šä¸‹æ–‡]...ï¼‰ |
| **ç”Ÿæˆæ–¹å¼** | ç›´æ¥ç»§æ‰¿ | LLM ç”Ÿæˆ |
| **ä¿¡æ¯é‡** | å°‘ï¼ˆä»…è§’è‰²ï¼‰ | å¤šï¼ˆå…¬å¸/æ—¶é—´/ç« èŠ‚ï¼‰ |

---

### 3. åˆ†å—ç­–ç•¥çµæ´»æ€§

| ç»´åº¦ | MemoryBear | Contextual Retrieval |
|------|-----------|---------------------|
| **ç­–ç•¥æ•°é‡** | 7 ç§å¯é€‰ | 1 ç§ï¼ˆå›ºå®š + ä¸Šä¸‹æ–‡ï¼‰ |
| **å¯é…ç½®æ€§** | é«˜ï¼ˆå¤šå‚æ•°ï¼‰ | ä¸­ï¼ˆä¸»è¦è°ƒ promptï¼‰ |
| **é€‚åº”æ€§** | å¼ºï¼ˆå¤šåœºæ™¯ï¼‰ | ä¸­ï¼ˆæ–‡æ¡£åœºæ™¯ï¼‰ |
| **å¤æ‚åº¦** | é«˜ | ä½ |

---

### 4. æ£€ç´¢ä¼˜åŒ–

| ç»´åº¦ | MemoryBear | Contextual Retrieval |
|------|-----------|---------------------|
| **æ£€ç´¢æ–¹å¼** | æ··åˆæœç´¢ï¼ˆå‘é‡ + å›¾è°±ï¼‰ | æ··åˆæœç´¢ï¼ˆBM25+ å‘é‡ï¼‰ |
| **å­—æ®µåŠ æƒ** | æ—  | æœ‰ï¼ˆå¤šå­—æ®µä¸åŒæƒé‡ï¼‰ |
| **æŸ¥è¯¢å¤„ç†** | åŸºç¡€æ¸…ç† | æŸ¥è¯¢æ‰©å±• + æ”¹å†™ |
| **Reranking** | æ—  | æœ‰ï¼ˆå¯é€‰ï¼‰ |

---

### 5. æˆæœ¬ç»“æ„

| ç»´åº¦ | MemoryBear | Contextual Retrieval |
|------|-----------|---------------------|
| **é¢„å¤„ç†æˆæœ¬** | ä½ï¼ˆæ—  LLMï¼‰ | ä¸­ï¼ˆLLM ç”Ÿæˆä¸Šä¸‹æ–‡ï¼‰ |
| **å­˜å‚¨æˆæœ¬** | ä½ | ä¸­ï¼ˆ+ä¸Šä¸‹æ–‡ tokensï¼‰ |
| **æ£€ç´¢æˆæœ¬** | ä¸­ | ä¸­ |
| **100 ä¸‡æ–‡æ¡£** | ~$0 | ~$8,000ï¼ˆä¸€æ¬¡æ€§ï¼‰ |

---

## ğŸ’¡ å¯¹ 100 ä¸‡ç ”æŠ¥åœºæ™¯çš„å¯ç¤º

### MemoryBear å¯å€Ÿé‰´çš„è®¾è®¡

#### 1. å¤šç­–ç•¥æ”¯æŒ

**å»ºè®®**ï¼šä¸è¦åªç”¨ä¸€ç§ chunking ç­–ç•¥

```python
# é’ˆå¯¹ä¸åŒæ–‡æ¡£ç±»å‹ä½¿ç”¨ä¸åŒç­–ç•¥
if document_type == "è´¢æŠ¥":
    strategy = "SemanticChunker"  # è¯­ä¹‰è¿è´¯
elif document_type == "ç ”æŠ¥":
    strategy = "RecursiveChunker"  # æŒ‰ç« èŠ‚
elif document_type == "æ–°é—»":
    strategy = "SentenceChunker"  # å¥å­çº§
```

---

#### 2. è§’è‰²ä¿¡æ¯ç»§æ‰¿

**å»ºè®®**ï¼šä¸º chunk æ·»åŠ æ¥æºä¿¡æ¯

```python
# ç ”æŠ¥åœºæ™¯
chunk = Chunk(
    content=f"[{company_name}] {chunk_content}",
    speaker=company_name,  # å…¬å¸åä½œä¸º"speaker"
    metadata={
        "report_id": report_id,
        "section": section_name,
        "report_date": report_date,
    }
)
```

---

#### 3. åˆ†å—è´¨é‡è¯„ä¼°

**å»ºè®®**ï¼šå®ç° chunking è´¨é‡æŒ‡æ ‡

```python
def evaluate_chunking(self, dialogue: DialogData) -> dict:
    chunk_sizes = [len(chunk.content) for chunk in chunks]
    
    return {
        "strategy": self.chunker_config.chunker_strategy,
        "num_chunks": len(chunks),
        "avg_chunk_size": np.mean(chunk_sizes),
        "chunk_size_std": np.std(chunk_sizes),  # å‡åŒ€åº¦
        "coverage_ratio": total_chars / len(dialogue.content),
    }
```

---

### Contextual Retrieval å¯å€Ÿé‰´çš„è®¾è®¡

#### 1. æ–‡æ¡£çº§ä¸Šä¸‹æ–‡å¢å¼º

**å»ºè®®**ï¼šä¸ºæ¯ä¸ª chunk æ·»åŠ ç ”æŠ¥å…ƒæ•°æ®

```python
# ç»“åˆ MemoryBear çš„ metadata è®¾è®¡
contextualized_chunk = f"""
[ä¸Šä¸‹æ–‡]
å…¬å¸ï¼š{company_name} ({stock_code})
æ–‡æ¡£ç±»å‹ï¼š{report_type}
æŠ¥å‘Šæ—¥æœŸï¼š{report_date}
ç« èŠ‚ï¼š{section_name}
è¡Œä¸šï¼š{industry}
[æ­£æ–‡]
{chunk_content}
"""
```

---

#### 2. å­—æ®µåŠ æƒ BM25

**å»ºè®®**ï¼šä¸åŒå­—æ®µä¸åŒæƒé‡

```python
fields = {
    "contextualized_content": 5.0,  # ä¸Šä¸‹æ–‡å†…å®¹
    "chunk_content": 1.0,           # åŸå§‹å†…å®¹
    "company_name": 10.0,           # å…¬å¸å
    "stock_code": 10.0,             # ä»£ç ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰
    "section": 3.0,                 # ç« èŠ‚
    "industry": 3.0,                # è¡Œä¸š
}
```

---

#### 3. æŸ¥è¯¢å¤„ç†ç®¡é“

**å»ºè®®**ï¼šæŸ¥è¯¢æ‰©å±• + æ”¹å†™

```python
# MemoryBear ç¼ºå°‘æŸ¥è¯¢å¤„ç†
# Contextual Retrieval æœ‰å®Œæ•´çš„æŸ¥è¯¢å¤„ç†æµç¨‹

ç”¨æˆ·æŸ¥è¯¢ â†’ è§£æ â†’ æ‰©å±• â†’ æ”¹å†™ â†’ ES æ£€ç´¢
```

---

## ğŸ¯ æ¨èæ–¹æ¡ˆï¼šæ··åˆè®¾è®¡

### æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ–‡æ¡£é¢„å¤„ç†                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. æ–‡æ¡£åˆ†å—                                        â”‚
â”‚     - ç­–ç•¥ï¼šRecursiveChunkerï¼ˆæŒ‰ç« èŠ‚/æ®µè½ï¼‰         â”‚
â”‚     - å¤§å°ï¼š800 tokens/chunk                        â”‚
â”‚     - è¾¹ç•Œï¼šä¼˜å…ˆæ®µè½/ç« èŠ‚è¾¹ç•Œ                       â”‚
â”‚                                                     â”‚
â”‚  2. ä¸Šä¸‹æ–‡å¢å¼ºï¼ˆContextual Retrievalï¼‰             â”‚
â”‚     - ä¸ºæ¯ä¸ª chunk ç”Ÿæˆä¸Šä¸‹æ–‡ï¼ˆ50-100 tokensï¼‰       â”‚
â”‚     - åŒ…å«ï¼šå…¬å¸åã€ä»£ç ã€æ—¥æœŸã€ç« èŠ‚                â”‚
â”‚     - ä½¿ç”¨ Prompt Caching é™ä½æˆæœ¬                  â”‚
â”‚                                                     â”‚
â”‚  3. å…ƒæ•°æ®ç»§æ‰¿ï¼ˆMemoryBear è®¾è®¡ï¼‰                   â”‚
â”‚     - chunk.metadata = {                            â”‚
â”‚         "report_id": ...,                           â”‚
â”‚         "section": ...,                             â”‚
â”‚         "chunk_index": ...,                         â”‚
â”‚       }                                             â”‚
â”‚                                                     â”‚
â”‚  4. è´¨é‡è¯„ä¼°ï¼ˆMemoryBear è®¾è®¡ï¼‰                     â”‚
â”‚     - è¯„ä¼° chunk å¤§å°åˆ†å¸ƒ                           â”‚
â”‚     - è¯„ä¼°è¦†ç›–ç‡                                    â”‚
â”‚     - è°ƒæ•´åˆ†å—å‚æ•°                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æ£€ç´¢æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ£€ç´¢æµç¨‹                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. æŸ¥è¯¢è§£æï¼ˆContextual Retrievalï¼‰               â”‚
â”‚     - æå–å…¬å¸åã€ä»£ç ã€æ—¶é—´ã€æŒ‡æ ‡                  â”‚
â”‚     - æŸ¥è¯¢æ‰©å±•ï¼ˆåŒä¹‰è¯ã€åˆ«åï¼‰                      â”‚
â”‚                                                     â”‚
â”‚  2. å­—æ®µåŠ æƒ BM25ï¼ˆContextual Retrievalï¼‰          â”‚
â”‚     - multi_match æŸ¥è¯¢                              â”‚
â”‚     - å­—æ®µåŠ æƒï¼ˆå…¬å¸åæƒé‡ 10ï¼Œä¸Šä¸‹æ–‡æƒé‡ 5ï¼‰         â”‚
â”‚                                                     â”‚
â”‚  3. æ··åˆæ£€ç´¢ï¼ˆMemoryBear è®¾è®¡ï¼‰                     â”‚
â”‚     - BM25ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰                              â”‚
â”‚     - å‘é‡æ£€ç´¢ï¼ˆè¯­ä¹‰åŒ¹é…ï¼‰                          â”‚
â”‚     - Rank Fusion åˆå¹¶                              â”‚
â”‚                                                     â”‚
â”‚  4. ï¼ˆå¯é€‰ï¼‰Reranking                              â”‚
â”‚     - Cohere Rerank / Voyage Rerank                 â”‚
â”‚     - top-150 â†’ top-20                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æˆæœ¬ä¼˜åŒ–

**ç»“åˆä¸¤è€…ä¼˜åŠ¿**ï¼š

| ä¼˜åŒ–æªæ–½ | æ¥æº | æ•ˆæœ |
|---------|------|------|
| **Prompt Caching** | Contextual Retrieval | æˆæœ¬é™ä½ 90% |
| **å¤šç­–ç•¥åˆ†å—** | MemoryBear | å‡å°‘ä¸å¿…è¦åˆ†å— |
| **è´¨é‡è¯„ä¼°** | MemoryBear | é¿å…ä½è´¨é‡ chunk |
| **å­—æ®µåŠ æƒ** | Contextual Retrieval | æé«˜æ£€ç´¢å‡†ç¡®ç‡ |

**é¢„ä¼°æˆæœ¬**ï¼š
```
åŸå§‹ Contextual Retrieval: $10,000
ä¼˜åŒ–åï¼š
- Prompt Caching: $8,000
- å¤šç­–ç•¥åˆ†å—ï¼ˆå‡å°‘ 20% chunksï¼‰: $6,400
- è´¨é‡è¯„ä¼°ï¼ˆè¿‡æ»¤ä½è´¨é‡ï¼‰: $6,000
```

---

## ğŸ“‹ å®æ–½å»ºè®®

### é˜¶æ®µ 1ï¼šåŸºç¡€å®ç°ï¼ˆ1-2 å‘¨ï¼‰

```
âœ… ä½¿ç”¨ MemoryBear çš„ RecursiveChunker
âœ… å®ç°åŸºç¡€åˆ†å—ï¼ˆæŒ‰ç« èŠ‚/æ®µè½ï¼‰
âœ… å®ç°å…ƒæ•°æ®ç»§æ‰¿
âœ… å®ç°è´¨é‡è¯„ä¼°

âŒ æš‚ä¸å®ç°ï¼šä¸Šä¸‹æ–‡å¢å¼º
```

---

### é˜¶æ®µ 2ï¼šä¸Šä¸‹æ–‡å¢å¼ºï¼ˆ2-3 å‘¨ï¼‰

```
âœ… å®ç°ä¸Šä¸‹æ–‡ç”Ÿæˆï¼ˆClaude APIï¼‰
âœ… ä½¿ç”¨ Prompt Caching ä¼˜åŒ–æˆæœ¬
âœ… å®ç°å­—æ®µåŠ æƒ BM25
âœ… å¯¹æ¯”å®éªŒï¼ˆæœ‰/æ— ä¸Šä¸‹æ–‡ï¼‰
```

---

### é˜¶æ®µ 3ï¼šæŸ¥è¯¢ä¼˜åŒ–ï¼ˆ3-4 å‘¨ï¼‰

```
âœ… å®ç°æŸ¥è¯¢è§£æ
âœ… å®ç°æŸ¥è¯¢æ‰©å±•
âœ… å®ç°å­—æ®µåŠ æƒæ£€ç´¢
âœ… ï¼ˆå¯é€‰ï¼‰Reranking
```

---

### é˜¶æ®µ 4ï¼šæŒç»­ä¼˜åŒ–ï¼ˆæŒç»­ï¼‰

```
âœ… æ”¶é›†æ£€ç´¢æ—¥å¿—
âœ… åˆ†æå¤±è´¥æ¡ˆä¾‹
âœ… è°ƒæ•´åˆ†å—å‚æ•°
âœ… ä¼˜åŒ–ä¸Šä¸‹æ–‡ prompt
```

---

## ğŸ“Š æ€»ç»“å¯¹æ¯”è¡¨

| ç»´åº¦ | MemoryBear | Contextual Retrieval | æ¨èæ–¹æ¡ˆ |
|------|-----------|---------------------|---------|
| **Chunking å•å…ƒ** | å¯¹è¯æ¶ˆæ¯ | æ–‡æ¡£åˆ†å— | æ–‡æ¡£åˆ†å—ï¼ˆæŒ‰ç« èŠ‚ï¼‰ |
| **ä¸Šä¸‹æ–‡ç±»å‹** | è§’è‰²ä¿¡æ¯ | æ–‡æ¡£å…ƒæ•°æ® | æ–‡æ¡£å…ƒæ•°æ® + å…ƒæ•°æ®ç»§æ‰¿ |
| **åˆ†å—ç­–ç•¥** | 7 ç§å¯é€‰ | å›ºå®š + ä¸Šä¸‹æ–‡ | å¤šç­–ç•¥ + ä¸Šä¸‹æ–‡å¢å¼º |
| **æ£€ç´¢ä¼˜åŒ–** | æ··åˆæœç´¢ | å­—æ®µåŠ æƒ BM25 | å­—æ®µåŠ æƒ + æŸ¥è¯¢æ‰©å±• |
| **æˆæœ¬** | ä½ | ä¸­ | ä¸­ï¼ˆä¼˜åŒ–åï¼‰ |
| **é€‚ç”¨åœºæ™¯** | å¯¹è¯è®°å¿† | æ–‡æ¡£æ£€ç´¢ | ç ”æŠ¥æ£€ç´¢ |

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**åˆ›å»ºæ—¥æœŸ**ï¼š2026-02-28  
**ä½œè€…**ï¼šJarvisï¼ˆåŸºäº MemoryBear ä»£ç åˆ†æ + Contextual Retrieval å­¦ä¹ ï¼‰  
**çŠ¶æ€**ï¼šDraft  
**ä¸‹æ¬¡ Review**ï¼šé˜¶æ®µ 1 å®Œæˆåæ›´æ–°
