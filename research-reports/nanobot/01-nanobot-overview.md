# nanobot - é¡¹ç›®æ¦‚è§ˆå’Œæ¶æ„åˆ†æ

**ç ”ç©¶é˜¶æ®µ**: Phase 1  
**ç ”ç©¶æ—¥æœŸ**: 2026-03-01  
**ç ”ç©¶æ–¹æ³•**: æ¯›çº¿å›¢ç ”ç©¶æ³• + GSD æµç¨‹ + Superpowers æŠ€èƒ½

---

## ğŸ“Š é¡¹ç›®æ¦‚è§ˆ

### æ ¸å¿ƒå®šä½

**nanobot** æ˜¯ä¸€ä¸ªè¶…è½»é‡çº§ä¸ªäºº AI åŠ©æ‰‹ï¼Œæ ¸å¿ƒä»£ç ä»…~4,000 è¡Œï¼Œæ¯” Clawdbot çš„ 43 ä¸‡è¡Œå° 99%ã€‚

**GitHub**: https://github.com/HKUDS/nanobot  
**Stars**: 23,839 â­  
**è®¸å¯è¯**: MIT  
**Python ç‰ˆæœ¬**: 3.11+

---

### æ ¸å¿ƒä»·å€¼ä¸»å¼ 

**é—®é¢˜**: ç°æœ‰ Agent æ¡†æ¶ï¼ˆå¦‚ OpenClawï¼‰è¿‡äºå¤æ‚ï¼ˆ43 ä¸‡è¡Œä»£ç ï¼‰ï¼Œéš¾ä»¥ç†è§£å’Œéƒ¨ç½²

**è§£å†³æ–¹æ¡ˆ**: 
- âœ… è¶…è½»é‡ï¼ˆ~4,000 è¡Œæ ¸å¿ƒä»£ç ï¼‰
- âœ… ç ”ç©¶å‹å¥½ï¼ˆä»£ç æ¸…æ™°æ˜“è¯»ï¼‰
- âœ… å¿«é€Ÿéƒ¨ç½²ï¼ˆä¸€é”®å¯åŠ¨ï¼‰
- âœ… åŠŸèƒ½å®Œæ•´ï¼ˆ11 ä¸ª Channels + å¤šç§ Toolsï¼‰

**ç±»æ¯”**: OpenClaw çš„è½»é‡çº§æ›¿ä»£æ–¹æ¡ˆ

---

### æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| **24/7 å®æ—¶å¸‚åœºåˆ†æ** | å®æ—¶æœç´¢å’Œåˆ†æå¸‚åœºæ•°æ® | è‚¡ç¥¨åˆ†æã€è¶‹åŠ¿å‘ç° |
| **å…¨æ ˆè½¯ä»¶å·¥ç¨‹å¸ˆ** | ä»£ç å¼€å‘å’Œéƒ¨ç½² | å¼€å‘ã€éƒ¨ç½²ã€æ‰©å±• |
| **æ™ºèƒ½æ—¥ç¨‹ç®¡ç†** | æ—¥å¸¸ä»»åŠ¡ç®¡ç† | æ—¥ç¨‹å®‰æ’ã€è‡ªåŠ¨åŒ– |
| **ä¸ªäººçŸ¥è¯†åŠ©æ‰‹** | çŸ¥è¯†åº“ç®¡ç† | å­¦ä¹ ã€è®°å¿†ã€æ¨ç† |

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          CLI å±‚                      â”‚
â”‚  nanobot agent -m "Hello"           â”‚
â”‚  (nanobot/cli/commands.py)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Channels å±‚                   â”‚
â”‚  - Feishu/Slack/Discord/Email/...  â”‚
â”‚  (nanobot/channels/*/channel.py)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        MessageBus å±‚                 â”‚
â”‚  - æ¶ˆæ¯é˜Ÿåˆ—å’Œè·¯ç”±                    â”‚
â”‚  (nanobot/bus/queue.py)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        AgentLoop å±‚ (æ ¸å¿ƒ)           â”‚
â”‚  - æ¥æ”¶æ¶ˆæ¯                          â”‚
â”‚  - æ„å»ºä¸Šä¸‹æ–‡                        â”‚
â”‚  - è°ƒç”¨ LLM                          â”‚
â”‚  - æ‰§è¡Œå·¥å…·è°ƒç”¨                      â”‚
â”‚  - å‘é€å“åº”                          â”‚
â”‚  (nanobot/agent/loop.py)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Tools å±‚                      â”‚
â”‚  - 11 ä¸ªå†…ç½®å·¥å…·                     â”‚
â”‚  - MCP å·¥å…·æ”¯æŒ                      â”‚
â”‚  (nanobot/agent/tools/*)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Providers å±‚                  â”‚
â”‚  - LLM Provider æŠ½è±¡                 â”‚
â”‚  - æ”¯æŒå¤šç§æ¨¡å‹                      â”‚
â”‚  (nanobot/providers/*)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æ ¸å¿ƒæ¨¡å—

| æ¨¡å— | ç›®å½• | ä»£ç è¡Œ | èŒè´£ |
|------|------|--------|------|
| **AgentLoop** | agent/loop.py | ~400 è¡Œ | æ ¸å¿ƒå¤„ç†å¼•æ“ |
| **ContextBuilder** | agent/context.py | ~200 è¡Œ | ä¸Šä¸‹æ–‡æ„å»º |
| **MemoryStore** | agent/memory.py | ~150 è¡Œ | è®°å¿†å­˜å‚¨ |
| **ToolRegistry** | agent/tools/registry.py | ~100 è¡Œ | å·¥å…·æ³¨å†Œ |
| **MessageBus** | bus/queue.py | ~200 è¡Œ | æ¶ˆæ¯é˜Ÿåˆ— |
| **Channels** | channels/ | ~1,000 è¡Œ | 11 ä¸ª Channels |
| **Providers** | providers/ | ~500 è¡Œ | LLM Provider |
| **Skills** | skills/ | ~300 è¡Œ | æŠ€èƒ½ç³»ç»Ÿ |

**æ€»æ ¸å¿ƒä»£ç **: ~3,932 è¡Œ

---

## ğŸ§¶ å…¥å£ç‚¹åˆ†æï¼ˆæ¯›çº¿å›¢ç ”ç©¶æ³• - çº¿å¤´è¯†åˆ«ï¼‰

### CLI å…¥å£

**æ–‡ä»¶**: `nanobot/__main__.py` â†’ `nanobot/cli/commands.py`

**ä½¿ç”¨æ–¹å¼**:
```bash
# åŸºæœ¬ç”¨æ³•
nanobot agent -m "Hello"

# æŒ‡å®šæ¨¡å‹
nanobot agent -m "Hello" --model qwen-plus

# å·¥ä½œç©ºé—´
nanobot agent -m "Hello" --workspace ./my-project
```

**æ ¸å¿ƒä»£ç **:
```python
# __main__.py
from nanobot.cli.commands import app

if __name__ == "__main__":
    app()
```

```python
# cli/commands.py
@app.command()
def agent(
    message: str = typer.Option(..., "--msg", "-m"),
    model: str | None = None,
    workspace: Path = typer.Option(Path.cwd(), "--workspace", "-w"),
):
    """Run nanobot agent with a message."""
    # 1. åŠ è½½é…ç½®
    config = load_config()
    
    # 2. åˆ›å»º AgentLoop
    loop = AgentLoop(...)
    
    # 3. è¿è¡Œ
    asyncio.run(loop.run(message))
```

---

### Python API å…¥å£

**æ–‡ä»¶**: `nanobot/agent/loop.py`

**ä½¿ç”¨æ–¹å¼**:
```python
from nanobot.agent.loop import AgentLoop
from nanobot.bus.queue import MessageBus
from nanobot.providers.base import LLMProvider

# åˆ›å»º AgentLoop
loop = AgentLoop(
    bus=MessageBus(),
    provider=LLMProvider(),
    workspace=Path("./workspace"),
    model="qwen-plus",
)

# è¿è¡Œ
await loop.run("Hello")
```

---

## ğŸ”— å®Œæ•´è°ƒç”¨é“¾ï¼ˆæ¯›çº¿å›¢ç ”ç©¶æ³• - é¡ºçº¿èµ°ï¼‰

### æ¶ˆæ¯å¤„ç†æµç¨‹

```mermaid
sequenceDiagram
    autonumber
    participant User as ç”¨æˆ·
    participant Channel as Channel
    participant Bus as MessageBus
    participant Loop as AgentLoop
    participant LLM as LLM Provider
    participant Tool as Tools
    
    User->>Channel: å‘é€æ¶ˆæ¯
    Channel->>Bus: publish_inbound(event)
    Bus->>Loop: consume_inbound()
    Loop->>Loop: 1. è·å–/åˆ›å»ºä¼šè¯
    Loop->>Loop: 2. æ„å»ºä¸Šä¸‹æ–‡
    Loop->>LLM: 3. è°ƒç”¨ LLM
    LLM-->>Loop: è¿”å›å“åº” (content + tool_calls)
    alt æœ‰å·¥å…·è°ƒç”¨
        Loop->>Loop: 4. è§£æå·¥å…·è°ƒç”¨
        Loop->>Tool: 5. æ‰§è¡Œå·¥å…·
        Tool-->>Loop: è¿”å›ç»“æœ
        Loop->>Loop: 6. æ·»åŠ ç»“æœåˆ°ä¸Šä¸‹æ–‡
        Loop->>LLM: 7. ç»§ç»­è¿­ä»£ (æœ€å¤š 40 æ¬¡)
        LLM-->>Loop: è¿”å›æœ€ç»ˆå“åº”
    end
    Loop->>Bus: 8. publish_outbound(response)
    Bus->>Channel: å‘é€å“åº”
    Channel->>User: è¿”å›ç»“æœ
```

---

### å…³é”®ä»£ç ä½ç½®

**1. AgentLoop æ ¸å¿ƒ**:
```python
# agent/loop.py:100-200
async def _process_message(self, event: InboundMessage) -> None:
    """å¤„ç†å•æ¡æ¶ˆæ¯"""
    session_key = self._get_session_key(event)
    
    # 1. è·å–æˆ–åˆ›å»ºä¼šè¯
    session = self.sessions.get_or_create(session_key)
    
    # 2. æ„å»ºä¸Šä¸‹æ–‡
    context = await self.context.build(
        session=session,
        message=event.message,
        memory_window=self.memory_window,
    )
    
    # 3. è°ƒç”¨ LLM
    response = await self.provider.chat(
        model=self.model,
        messages=context.messages,
        tools=self.tools.get_schema(),
        temperature=self.temperature,
        max_tokens=self.max_tokens,
    )
    
    # 4. è§£æå·¥å…·è°ƒç”¨
    if response.tool_calls:
        for tool_call in response.tool_calls:
            result = await self.tools.execute(tool_call)
            # æ·»åŠ ç»“æœåˆ°ä¸Šä¸‹æ–‡ï¼Œç»§ç»­è¿­ä»£
    
    # 5. å‘é€å“åº”
    await self.bus.publish_outbound(
        channel=event.channel,
        chat_id=event.chat_id,
        message=response.content,
    )
```

**2. Channel æ³¨å†Œ**:
```python
# channels/__init__.py
from .feishu.channel import FeishuChannel
from .slack.channel import SlackChannel
from .discord.channel import DiscordChannel
# ... 11 ä¸ª Channels

ALL_CHANNELS = {
    "feishu": FeishuChannel,
    "slack": SlackChannel,
    "discord": DiscordChannel,
    # ...
}
```

**3. Tool æ³¨å†Œ**:
```python
# agent/loop.py:110-130
def _register_default_tools(self) -> None:
    """æ³¨å†Œé»˜è®¤å·¥å…·"""
    allowed_dir = self.workspace if self.restrict_to_workspace else None
    
    # æ–‡ä»¶æ“ä½œå·¥å…·
    for cls in (ReadFileTool, WriteFileTool, EditFileTool, ListDirTool):
        self.tools.register(cls(workspace=self.workspace, allowed_dir=allowed_dir))
    
    # æ‰§è¡Œå·¥å…·
    self.tools.register(ExecTool(...))
    
    # Web å·¥å…·
    self.tools.register(WebSearchTool(api_key=self.brave_api_key))
    self.tools.register(WebFetchTool())
    
    # æ¶ˆæ¯å·¥å…·
    self.tools.register(MessageTool(send_callback=self.bus.publish_outbound))
    
    # å­ Agent å·¥å…·
    self.tools.register(SpawnTool(manager=self.subagents))
```

---

## ğŸ¯ è®¾è®¡æ¨¡å¼è¯†åˆ«ï¼ˆSuperpowers - Systematic Analysisï¼‰

### 1. å‘½ä»¤æ¨¡å¼ï¼ˆCommand Patternï¼‰

**å®ç°**:
```python
# agent/tools/base.py
class Tool(ABC):
    @abstractmethod
    def execute(self, **kwargs) -> Any:
        """æ‰§è¡Œå·¥å…·"""
        pass
    
    @abstractmethod
    def get_schema(self) -> dict:
        """è·å–å·¥å…· schema"""
        pass

# æ¯ä¸ªå·¥å…·æ˜¯ä¸€ä¸ªå‘½ä»¤
class ReadFileTool(Tool):
    def execute(self, path: str) -> str:
        with open(path) as f:
            return f.read()
```

**ä¼˜åŠ¿**:
- âœ… å·¥å…·ç»Ÿä¸€æ¥å£
- âœ… æ˜“äºæ‰©å±•æ–°å·¥å…·
- âœ… å·¥å…·å¯ç»„åˆ

---

### 2. è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰

**å®ç°**:
```python
# bus/queue.py
class MessageBus:
    def __init__(self):
        self._inbound_queue = asyncio.Queue()
        self._outbound_queue = asyncio.Queue()
    
    async def publish_inbound(self, event: InboundMessage):
        await self._inbound_queue.put(event)
    
    async def consume_inbound(self) -> InboundMessage:
        return await self._inbound_queue.get()
```

**ä¼˜åŠ¿**:
- âœ… è§£è€¦ Channel å’Œ AgentLoop
- âœ… æ”¯æŒå¼‚æ­¥å¤„ç†
- âœ… æ”¯æŒå¤šæ¶ˆè´¹è€…

---

### 3. ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰

**å®ç°**:
```python
# providers/base.py
class LLMProvider(ABC):
    @abstractmethod
    async def chat(self, messages, **kwargs) -> LLMResponse:
        pass

# æ¯ä¸ª Provider æ˜¯ç‹¬ç«‹ç­–ç•¥
class QwenProvider(LLMProvider):
    async def chat(self, messages, **kwargs):
        # Qwen API è°ƒç”¨

class OpenAIProvider(LLMProvider):
    async def chat(self, messages, **kwargs):
        # OpenAI API è°ƒç”¨
```

**ä¼˜åŠ¿**:
- âœ… æ”¯æŒå¤šç§ LLM
- âœ… æ˜“äºæ·»åŠ æ–° Provider
- âœ… è¿è¡Œæ—¶å¯åˆ‡æ¢

---

### 4. å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰

**å®ç°**:
```python
# config/manager.py
class ConfigManager:
    _instance = None
    
    def __new__(cls):
        if cls._instance is None:
            cls._instance = super().__new__(cls)
            cls._instance._load_config()
        return cls._instance
```

**ä¼˜åŠ¿**:
- âœ… é…ç½®å…¨å±€å”¯ä¸€
- âœ… å»¶è¿ŸåŠ è½½
- âœ… çº¿ç¨‹å®‰å…¨

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| **æ ¸å¿ƒä»£ç è¡Œ** | ~3,932 è¡Œ |
| **Python æ–‡ä»¶æ•°** | ~100 ä¸ª |
| **Channels** | 11 ä¸ª |
| **Tools** | 11+ ä¸ª |
| **Providers** | 10+ ä¸ª |
| **Skills** | å†…ç½® + å¯æ‰©å±• |

---

## ğŸ¯ Phase 1 éªŒæ”¶

### éªŒæ”¶æ ‡å‡†

| æ ‡å‡† | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| âœ… ç†è§£é¡¹ç›®å®šä½ | å®Œæˆ | è½»é‡çº§ Agent æ¡†æ¶ |
| âœ… ç†è§£æ ¸å¿ƒæ¶æ„ | å®Œæˆ | AgentLoop + Channels + Tools |
| âœ… è¯†åˆ«å…¥å£ç‚¹ | å®Œæˆ | CLI + Python API |
| âœ… è¿½è¸ªè°ƒç”¨é“¾ | å®Œæˆ | æ¶ˆæ¯å¤„ç†æµç¨‹ |
| âœ… è¯†åˆ«è®¾è®¡æ¨¡å¼ | å®Œæˆ | å‘½ä»¤ + è§‚å¯Ÿè€… + ç­–ç•¥ + å•ä¾‹ |
| âœ… ç»˜åˆ¶æ¶æ„å›¾ | å®Œæˆ | è§ä¸Šæ–‡ |
| âœ… ä»£ç ä½ç½®ç´¢å¼• | å®Œæˆ | å…³é”®ä»£ç ä½ç½® |

---

## ğŸ“ ç ”ç©¶ç¬”è®°

### å…³é”®å‘ç°

1. **AgentLoop æ˜¯æ ¸å¿ƒ**ï¼ˆ~400 è¡Œï¼‰- æ¶ˆæ¯å¤„ç†å¼•æ“
2. **Channels æŠ½è±¡ä¼˜ç§€** - 11 ä¸ª Channels ç»Ÿä¸€æ¥å£
3. **Tools ç³»ç»Ÿçµæ´»** - å‘½ä»¤æ¨¡å¼ + æ³¨å†Œæœºåˆ¶
4. **Providers å¯æ‰©å±•** - ç­–ç•¥æ¨¡å¼æ”¯æŒå¤šç§ LLM

### å¾…æ·±å…¥ç ”ç©¶

- [ ] AgentLoop è¯¦ç»†å®ç°ï¼ˆPhase 2ï¼‰
- [ ] 11 ä¸ª Channels è¯¦ç»†åˆ†æï¼ˆPhase 3ï¼‰
- [ ] Tools ç³»ç»Ÿæ·±åº¦åˆ†æï¼ˆPhase 3ï¼‰
- [ ] ä¸ MemoryBear å¯¹æ¯”ï¼ˆPhase 4ï¼‰

---

## ğŸ”— ä¸‹ä¸€æ­¥ï¼šPhase 2

**ç›®æ ‡**: æ·±å…¥åˆ†æ AgentLoop å’Œæ¶ˆæ¯å¤„ç†æµç¨‹

**ä»»åŠ¡**:
- [ ] åˆ†æ AgentLoop å®ç°ç»†èŠ‚
- [ ] è¿½è¸ªæ¶ˆæ¯å¤„ç†å®Œæ•´æµç¨‹
- [ ] åˆ†æ Context æ„å»ºæœºåˆ¶
- [ ] åˆ†æ Memory ç³»ç»Ÿ

**äº§å‡º**: `02-agent-loop-analysis.md`

---

**ç ”ç©¶æ—¥æœŸ**: 2026-03-01  
**ç ”ç©¶è€…**: Jarvis  
**æ–¹æ³•**: æ¯›çº¿å›¢ç ”ç©¶æ³• + GSD æµç¨‹ + Superpowers æŠ€èƒ½
